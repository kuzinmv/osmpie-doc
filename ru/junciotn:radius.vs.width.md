# Использование тегов width и junction:radius в OpenStreetMap: различия в подходах к описанию геометрии

Данная статья является ответом на вопрос
~~~
С наскоку трудно понять, что такое зона конфликта, 
чем отличается пример 2 от 3 и зачем вообще это наносить?
~~~

![image info](./img/junction-surface-skeleton1.png)

## Введение

При картировании в OpenStreetMap мы часто сталкиваемся с необходимостью описать геометрические характеристики объектов. Два ключевых подхода — использование тега `width` для линейных объектов (например, way) и `junction:radius` для node — представляют разные подходы к упрощению сложных геометрических форм.

## Концепция тега width. От полигона к прямоугольнику

Для более точного понимания последующих положений настоятельно рекомендуем ознакомиться с соответствующими статьями на OSMwiki:

- [https://wiki.openstreetmap.org/wiki/Key:width](https://wiki.openstreetmap.org/wiki/Key:width)
- [https://wiki.openstreetmap.org/wiki/Street_parking](https://wiki.openstreetmap.org/wiki/Street_parking)

Вот ключевые выдержки из них:

~~~
width:lanes=1.5|2.5|2.5
~~~

~~~
parking:side:width for the width=* of the parking space: In many places, depending on the orientation of the vehicles 
and the local norms, parking lanes have a default width that doesn't need to be mapped 
explicitly, but there may be variations from this like very narrow or very wide parking spaces.
~~~


### Теоретическое обоснование

Тег `width` в OpenStreetMap основан на концептуальном упрощении: мы представляем сложную форму дороги как прямоугольник. Реальная дорога представляет собой полигон произвольной формы, но для практических целей мы упрощаем её до воображаемого прямоугольника и определяем одну из его сторон 'width'.

### Практические примеры использования

**Ширина полос движения:**
```
width:lanes=1.5|2.5|2.5
```
Здесь мы указываем ширину каждой полосы отдельно, что позволяет более точно описать геометрию дороги.

**Ширина парковочных мест:**
```
parking:side:width=2.0
```
Согласно документации OSM, во многих местах парковочные места имеют стандартную ширину, которую не нужно указывать явно, но бывают существенные отклонения от стандарта, которые требуют явного определения.

### Ключевые принципы применения width

1. **Линейная аппроксимация**: Объект рассматривается как линия с шириной
2. **Прямоугольная модель**: Предполагается, что форма объекта близка к прямоугольнику
3. **Практическая применимость**: Подходит для большинства дорог и улиц

## Концепция тега junction:radius. От полигона к окружности

Напомним, что такое junction и его особенности, важные для картирования с фокусом на топологическую достоверность.

- [https://wiki.openstreetmap.org/wiki/Tag:junction=yes](https://wiki.openstreetmap.org/wiki/Tag:junction%3Dyes)

Тег junction применим к node, чтобы обозначить точку пересечения, и к way, чтобы обозначить полигон пересечения (или перекрёстка), если добавить ещё `area=yes`.

~~~
Draw a closed way tagged with area=yes around the junction area as found on the ground,
and add the junction=yes tag.
~~~

### Теоретическое обоснование

Тег `junction:radius` представляет альтернативный подход упрощения. Вместо прямоугольника мы используем окружность для описания зоны пересечения. Это упрощение менее интуитивно, чем в случае с дорогами, но имеет свои преимущества.

### Сравнение подходов к junction

| Подход | Описание | Применение |
|--------|----------|------------|
| `junction=yes` на node | Точечное обозначение пересечения | Простые перекрёстки |
| `junction:radius=X` на node | Радиус зоны конфликта | Сложные пересечения с известной геометрией |
| `junction=yes` + `area=yes` на way | Полигональное описание | Точное картирование больших развязок |

Проанализируем примеры, приведенные выше:

| node[junction = yes] | node[junction:radius = 8] | way[junction=yes + area=yes] | 
| :------------------- | :------------------------ | :--------------------------- |
| ![image info](https://wiki.openstreetmap.org/w/images/7/7e/Junction_yes_example_1.png) | ![image info](./img/junction:radius-img10.png) | ![image info](https://wiki.openstreetmap.org/w/images/thumb/2/22/Example_id_junction_area.png/360px-Example_id_junction_area.png) | 
| Использован тег `junction = yes` для точки, как аналог `parking:side:lane` или `yes` | radius – такой же понятный атрибут для упрощения площадных представлений об объекте, как width для way | Картируем развязку полигональым описанием |

### Определение junction:radius

**junction:radius** — радиус окружности, **соотносящийся** с полигоном зоны конфликта, в которой взаимодействуют транспортные средства и/или пешеходы.

См. статью про [junction:radius](./node.tags.junction:radius.md). 

## Когда использовать каждый подход?

### Используйте width когда:
- Картируете линейные объекты (дороги, тротуары, реки)
- Форма объекта относительно равномерная по ширине
- Объект можно разумно аппроксимировать прямоугольником
- Нужно описать различную ширину полос

### Используйте junction:radius когда:
- Пересечение имеет округлую или близкую к округлой форму зоны конфликта
- Стандартные расчёты радиуса по количеству и ширине полос недостаточно точны
- Есть особенности геометрии пересечения, требующие явного указания

### Используйте полигональный junction когда:
- Пересечение имеет сложную форму
- Требуется максимальная точность
- Размер и сложность развязки оправдывают детальное картирование

## Практические рекомендации

### Автоматический вывод vs явное указание

**Для width:**
- Многие приложения могут вычислить приблизительную ширину дороги по её классу либо путем умножения ширины полосы на количество полос
- Явное указание нужно при отклонениях от стандарта

**Для junction:radius:**
- Радиус часто может быть рассчитан из характеристик пересекающихся дорог
- Явное указание необходимо для точного соответствия реальности

### Связь с существующими практиками

Подход с использованием радиусов для геометрических характеристик уже применяется в OSM. Например, проект картирования парковок в Берлине использует точечные объекты с радиусом для описания парковочных зон.

- [Парковки в Берлине](https://github.com/SupaplexOSM/street_parking.py?tab=readme-ov-file)

| . | . | 
| :------------------- | :------------------------ | 
| ![image info](https://raw.githubusercontent.com/SupaplexOSM/street_parking.py/main/sample%20images/street%20parking%20lines.png) | ![image info](https://raw.githubusercontent.com/SupaplexOSM/street_parking.py/main/sample%20images/street%20parking%20points.png) |  

## Заключение

Выбор между `width` и `junction:radius` определяется:

1. **Типом объекта**: линейный vs точечный
2. **Геометрией**: прямоугольная vs круглая аппроксимация
3. **Точностью требований**: стандартная vs специфическая геометрия
4. **Практическими соображениями**: простота картирования vs детализация

Оба подхода представляют собой компромисс между точностью и практичностью, позволяя картографам эффективно описывать сложные геометрические объекты с помощью простых параметров.
