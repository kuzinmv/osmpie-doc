# junction:cluster:radius — тег для функциональной зоны пересечения.

Функциональная зона пересечения — это геометрическая фигура, находящиеся внутри которой объекты подвержены влиянию данного пересечения или сами влияют на него.
В данной зоне другие объекты (парковки, переходы, стоп-линии и так далее) могут отображаться или интерпретироваться иначе, нежели в отсутствии данного пересечения.
В какой-то степени это понятие соотносится с понятием функциональной зоны перекрестка, только для простейшего пересечения.

### Синтаксис
```
node.tags {
   junction:cluster:radius: number[1..N]
}
```

### Применение

Данный тег применяется для объектов типа `node`, являющихся пересечением.
Тег указывает радиус окружности, в которую может быть вписана функциональная зона для данного пересечения.
 
### Преимущества данного тега

Главной мотивацией введения этого тега было обеспечить возможность группировки нод соседних пересечений в обобщающее
понятие **"Перекресток"**. 

Данная цель может быть достигнута различными подходами:

1. Relation: `type:intersection, members[node1,...,nodeN, way1,..., wayM]`
2. Атрибут у ноды, который является ключом обобщения (имя-идентификатор кластера) `junction:cluster = name or id`
3. Радиус, который при наложении (union) окружностей даст общий полигон для некоторого множества нод `junction:cluster = 5`

Все эти способы решают одну задачу - **управляемая кластеризация нод пересечений** в некую более сложную структуру данных.

Плюсы и минусы первых двух подходов очевидны: необходимость использовать relation, сохранить ссылочная целостность, генерировать тег.

Рассмотрим третий способ.

* Очень геометричный, отражает площадные/линейные характеристики пересечения
* Не требует поддержки ссылочной целостности (как в 1) и контроля уникальности (как в 2)
* Можно найти зависимость или корреляцию с другими свойствами ноды (число полос)
* Просто числовое значение в метрах
* Формально нового объекта типа перекресток не появляется, но он всегда может быть получен простейшей операцией buffer + union
* Соответствует принципу бритвы Оккама - не плодим новых сущностей без необходимости

Формально понятие **Перекресток** можно попытаться выразить так:
Перекресток — это такое множество узлов (`node junction=yes|...`), связанных между собой ребрами (`way`), на которых
средствами ОДД (разметкой, знаками иными элементами ОДД) **НЕ** предусмотрена остановка транспортных средств.

Говоря простым языком, перекрестком можно считать такое множество точек и дуг, где внутри нет специально организованных стоп-линий.
Также можно сказать, что перекресток — это площадная фигура (полигон), внутри которой существует неделимая зона конфликта транспортных средств и пешеходов.

Рассмотрим пример сложного перекрестка, где есть 4 отдельных зоны конфликта.
В нодах, где `junction:cluster:radius:` не указан явно, он равен 12 метрам.
На левой половине — ноды и вэйи, на правой половине — модель перекрестка, где радиус каждой ноды отображен в виде гексагона. 
Все гексагоны объединены в группы по признаку наложения (union).

![image info](./img/junction:cluster:radius-img1.png)

В итоге, с такой комбинацией значений `junction:cluster:radius:` мы имеем 4 "Перекрестка", у каждого
из которых есть своя зона конфликта и получается, что *должны* быть свои отдельные стоп-линии для его разрешения.

![image info](./img/junction:cluster:radius-img4.png)

Чтобы не возникало сомнений, что это может быть одно, а не несколько пересечений, добавлю картинку с топологией сети, где каждое пересечение обозначено голубым кругом,
(см. тег [junction:radius](./node.tags.junction:radius.md)), где в каждый кластер входит 3-4 пересечения вэйев (автомобильных и пешеходных разных радиусов).

![image info](./img/junction:cluster:radius-img5.png)

Увеличим значения `junction:cluster:radius:` с двенадцати до тридцати двух метров.
Все пересечения объединились в один перекресток в форме подковы. При такой комбинации радиусов этот перекресток
напоминает кольцо (полукольцо), внутри которого участники движения не имеют права останавливаться.
Этот вариант расстановки радиусов искусственно-неверный, так как пешеходные переходы все равно остались.

![image info](./img/junction:cluster:radius-img3.png)


---

## Еще один пример применения тэга, в связке с другими тэгами junction:* 

Основной задачей данного тэга является возможность не только точечного соединения двух пересечений друг с дургом, но и возможность
отделения. Когда два пересечения расположены достаточно близко, но при этом не являются одним перекрестком.
Такие случае редки, но всеже бывают и это нельзя сбрасывать со счетов.
Тогда эксплицитная установка значений и нужна. 
Это значительно снижает общую трудоемкость, в отличие от применения предполагаемого relation, к примеру.

![image info](./img/junction:cluster:radius-img7.png)

Если посмотреть на то как в большинстве случаев группируются пересечения с высоты птичьего полета (на примере со светофоров),
то видно, что образуются явные кластера, и тем или иным способом мы могли бы это делать автоматически.
И  тогда появляется вопрос, если вводить relation эксплицитно, то все это придется мапить вручную? - Долго, муторно и зачем...


![image info](./img/junction:cluster:radius-img8.png)

Но при этом, очень важно иметь инструмент, для решения случаев, как на рисуке выше. 

С первого взгляда ничего сложного, обычный Т образный перекресток, но это только на первый взгляд.

В реальности это регулируемый пешеходный переход - синее, не регулируемй пешеходный переход, серое, и
нерегулируемое пересечение - белое, для разворота и поворота налево, которое нельзя считать нерегулируемым 
перекрестком, оно очень близко расположено к регулируеммому пешеходному переходу, но его надо логически 
отделить, иначе вся зона бдует считаться регулируемой, изменится разметка.

поэтому для точек в белой области, мы должны задать 

~~~
   junction = no  - явно это не перекресток (разметка будеет соответсвовать обчной лнейон разметке на дорогах)
   junction:cluster:radius = 1  - чтобы он не склеился с другими двумя кластерами (синним и серым)
   junction:radius = 7~8   - метров, так как это все равно пересечение и оно имеет геометрические характеристики
~~~

При этом для ноды персечения в серой области, тоже надо явно задать небольшой радиус кластеризации,
чтобы не склеивать, с синим, так как они по существу имеют разные типы (controlled и uncontrolled)

## Выводы
 - Применение точечно управлеямой кластеризации нод пересечений в перекрестки, значительно сокращает трудозатраты на
 правильное картирование перекрестков, применяя их явно и только в исключительных случаях.
 - Комбинации с другими тегами junction:radius и junction = yes|no|.... позволяет точно отобразить все то множество вариантов, которые встречаются на реальной дороге.
 - И самое главное сохраняется/появляется семантика, то есть атрибуты точно описывают или указывают на качества(функции)объекта на дороге.