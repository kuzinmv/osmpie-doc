## 1. Порядок работы и формы ввода

Основной флоу работы с редактором OSMPIE предполагается следующий:

1. После загрузки данных, они отражаются в левой и правой окнах редактора
2. Далее выбирая объекты мышкой в левой части, перетаскивая их меняя свойства или добавляя новые объекты, 
вы приводите перекресток к нужному вам виду
3. Далее можно открыть окно просмотра changeset, чтобы понять,какие изменения были сделаны и что отправиться на сервер OSM,
там же можно скачать OSMcs файл
4. Если в процссе редактирования вы удалили(node или way) или сплитнули way, то перед тем как перейти к отправке изменений вам будет предложено починить
все relations связанные с удаленными объектами. Если ничего не удаляли то сразу к шагу отправки.
5. В результате автоматического исправления relation дальнейшее редактирование будет запрещено, и модель переведена в режим только чтение. 
Однако останется возможность вручную исправить relatioins, если вы понимаете что делаете. Или отменить этот шаг и вернуться к редактированию.
6. В любой моммент времени вы можете поделиться ссылкой с другим участником для обсуждения вашей работы, только автор может вносить исправления, 
для всех остальных можно только просмотреть изменения.
7. После отправки в OSM ваша работа останется в режиме только для чтения уже для всех и для автора в том числе.


---

## 2. Окно редактирования свойств объекта

Для редактирования свойств объекта, его надо выделить мышкой, и нажать кнопку в левом нижнем углу экрана.

Она активирует/деактивирует режим просмотра/редактирования свойств.

Да это **YAML!** со всеми вытекающими из этого [плюсами](https://ru.wikipedia.org/wiki/YAML) и минусами. 
В форме есть автокомплит для ускорения рутинной работы по исправлению свойств(схемы тэгов не полные).

![image info](./img/screen4.png)

Выкючить режим просмотра/редактирования свойств - еще одно нажатие на эту кнопку.

---

## 3. Окно опций рендера OSMPIE

| Опциия | Назначение/описание |
| :------- | :------ |
| `Lane's width ([p,s,t] + width:lanes) (m)` | Базовая ширина полосы в метрах, для основных дорог (primary, secondary, tertiary), остальные значения получаются коэффициентами от этого значения. Разумеется все можно переопределить тэгом `width:lanes: *` |
| `Remove edges less than ... (m)` | Удалять ребра результирующего графа длинной менее Х метров, иногда полезно ставить  0, при отладке  |
| `Default way's osmpie:fill value (veh,bus,psv) (m)` | Установить новую точку каждые Х метров для дорог |
| `Default way's osmpie:fill value (tram,cycle) (m)` | Установить новую точку каждые Х метров для трамваев и велосипедов |
| `Default node's junction:cluster:radius value (m)` | Базовое значение junction:cluster:radius для всех точек если не переопределено в свойствах node |
| `Max route radius (m)` | Расстояние от центра перекрестка до начала и конца микро-роутов |
| `Max area of polygon's hole filling (sq. m)` | Предельная площадь дырок, которые нужно заливать цветом асфальта|
| `Ignore restriction relations` | Иногда удобно игнорировать все relation типа restriction |
| `Filter way[highway=service]` | Если установить эту опцию, то и way[service] будуть попадать в рендер, дольше больше возни, ну для красоты пойдет |
| `1. Step connect points` | Шаги с 1 по 4 чисто отладочные не рекомендуем выключать |
| `2. Step connect rest veh` | ... |
| `3. Step connect extra (tram,cycle,ped)` | ... |
| `4. Step guess stoplines` | ... |
| `5. Step build routes` | Строить или нет микро роуты через перекрестки |
| `6. Step build road MultiPolygon` | Строить полигоны дороги |
| `7. Step build conflict points` | Находим конфликтные точки на пеерсечении |
| `8. Step build road markings` | Рисуем линейную разметку на дорогах |
| `8.1 Step build intersection markings` | И отдельно опция для того же, но на перекрестке |

![image info](./img/screen5.png)

---

## 4. Changeset viewer - просмотр изменений

Это специальное окно, в котором можно видеть текущее состояние ваших правок.
Открывается после нажатия на кнопку с тремя бэйджиками с цифрами. 
Список элементов, которые были удалены, добавлены или изменены.
Список упорядочен по дате изменения, новые сверху, легко отфильтровать нужные по операции или объекту или идентификатору.
Выбирая тот или иной объект в нижней части окна посвечиваются изменения, относительно его начального состояния, которое было загружено из overpass.
Diff по подобию с Git.

![image info](./img/screen6.png)

---

## 5. Changeset viewer - ссылочная целостность - исправление relations

Если вы удаляли(или делали операцию сплит) объекты way или node, то редактор предложит вам провести автоматическое исправление ссылок, на удаленные объекты.
Нажатие кнопки **Check & fix relation**, программа обратится к overpass API и выберет все relation, которые имеют ref на удаленные объекты.

1. Для разрезанных way ссылки в member на старые будут заменены на ссылки новых way (c учетом порядка для route)
2. Для удаленных, просто удалит ссылающиеся member
3. В случае если вы удалили way и заного нарисовали новый, то необходимо будет исправить relation в ручную.
4. После фикса relation редактирование будет запрещено, редактор перейдет в режим только для чтения.
5. Вернуться к редактированию можно нажав кнопку отмены **Cancel relation fix**

![image info](./img/screen7.png)

---

## 6. Changeset viewer - отправка изменений в OSM

Если вы уверены, что все готово, необходимые правки внесены и ссылки не сломаны. Нажимайте кнопку **Apply to OSM**, чтобы перейти к финальному шагу.
Останется только ввести коментарий к вашему changeset и выбрать или дописать свои тэги источников. 
Поздравляем вас с новым соершенным перекрестком в  OSM

![image info](./img/screen8.png)

---

## 7. Просмотр микро-маршрутов для валидации перекрестка

В правой части окна, объекты также доступны для выбора мышкой для  просмотра их свойств. Однако при выборе 
объектов типа кластер (облако гексагонов) появляется дополнительное окно с возможностью выбора(включения)
микро-роутов, которые были построены движком OSMPIE для этого перкрестка.

С помощью этой визуализации удобно бустро оценивать правильность структуры полос и связность по каждому подходу.

![image info](./img/screen11.png)

---

## 8. Редактор в режиме только чтение

Режим только для чтения, исключает возможность внесения изменений. Он активируется при просмотре вашей работы другим пользователем 
либо после того, как были исправлены релэйшны или changeset отправлен в OSM.
Удобен для того чтобы делится своей работой с другими участникам для обсуждений деталей, или если у вас есть несколько вариантов одного 
перекрестка для сравнения в разных вкладках. Имеется режим отображения было-стало, для в структуры данных OSM в левой части.
Для рендера в правой части можно использовать переключатель **use changes** для этих же целей.

![image info](./img/screen9.png)

---




